!*********************************************************************************************************
!**                                     Developped by Tomas Tamfal 					**
!**                                       Version 0.1 January 2018	                               	**
!*********************************************************************************************************

!**********************************************************************************************************
!            Create_mesh.F90:  Computes the mesh of the computing grid and outputs it
!**********************************************************************************************************

#include "choice.def"
subroutine mesh

!**********************************************************************************************************
	use parameters
  	use variables
      
!**********************************************************************************************************
	implicit none
	integer :: i, j, k

!**********************************************************************************************************


!**********************************************************************************************************

!**********************************************************************************************************
!**************************** Computes linear r mesh *************************************
#ifdef LIN_MESH
	dx(1)	    = 1D0 / dble(nx)
        x(1)        = 0D0 - nghost*dx(1)
	x_center(1) = x(1) + 0.5D0*dx(1)

	do i = 2, x_end
	        dx(i) 		= dx(1)
		x(i) 		= x(i-1) +  dx(i)  
		x_center(i) 	= x(i)   + 0.5D0*dx(i)
                enddo
	x(x_end+1) = x(x_end) +  dx(x_end) 

#endif!     LIN_MESH

!**************************** Computes log r mesh ****************************************
#ifdef LOG_MESH
	do i = 2, x_end+1
		x(i) 		= xin **(dble(i) - dble(ini+nghost) + 0.5D0)
		dx(i) 		= x(i) * (dsqrt(ratio) - 1.D0/dsqrt(ratio))
		x_center(i) 	= x(i)*dsqrt(ratio)
	enddo  

#endif LOG_MESH
!**************************** Computes phi mesh ********************************************



!***************** Print the mesh in r.data and theta.data *******************************
	open(10, file='x_grid.txt', status='replace')
	do i = 1, x_end+1
		write(10,*) x(i)
	enddo
	close(10)
        
        
        open(20, file='x_center.txt', status='replace')
	do i = 1, x_end
		write(20,*) x_center(i)
	enddo
	close(20)






!**********************************************************************************************************
#ifdef TWO
!**********************************************************************************************************
!**************************** Computes linear r mesh *************************************
#ifdef LIN_MESH

	dy(1)	    = 1D0 / dble(ny)
        y(1)        = 0D0 - nghost*dy(1)
	y_center(1) = y(1) + 0.5D0*dy(1)

	do i = 2, x_end
	        dy(i) 		= dy(1)
		y(i) 		= y(i-1) +  dy(i)  
		y_center(i) 	= y(i)   + 0.5D0*dy(i)
                enddo
	y(y_end+1) = y(y_end) +  dy(y_end) 
#endif!     LIN_MESH







!**************************** Computes phi mesh ********************************************



!***************** Print the mesh in r.data and theta.data *******************************
	open(30, file='y_grid.txt', status='replace')
	do i = 1, y_end+1
		write(30,*) y(i)
	enddo
	close(30)
        
        
        open(40, file='y_center.txt', status='replace')
	do i = 1, y_end
		write(40,*) y_center(i)
	enddo
	close(40)
#endif !TWO


return
!**********************************************************************************************************
end subroutine mesh
!**********************************************************************************************************
